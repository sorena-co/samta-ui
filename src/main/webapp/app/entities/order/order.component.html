<div class="component">
    <p-breadcrumb [model]="breadcrumbItems"></p-breadcrumb>
    <jhi-alert></jhi-alert>
    <br/>
    <p-dataTable [sortField]="predicate" [sortOrder]="reverse ? 1 : -1" #dt [value]="orders" [lazy]="true"
                 [rows]="itemsPerPage"
                 [rowsPerPageOptions]="[5,10,20,totalItems]"
                 [paginator]="true" [responsive]="true" [stacked]="false"
                 [totalRecords]="totalItems" (onLazyLoad)="loadLazy($event)"
                 [emptyMessage]="'global.messages.info.emptyRecords' | translate">
        <p-header>
            <div class="ui-helper-clearfix">
                <button class="btn btn-primary float-right "
                        *jhiHasAnyAuthority="['ROLE_ADMIN', 'CREATE_ORDER']"
                        [routerLink]="['/order/order-new/'+mode]">
                    <span class="fa fa-plus"></span>
                    <span jhiTranslate="entity.action.create">Create</span>
                </button>
            </div>
        </p-header>

        <p-headerColumnGroup>
            <p-row>
                <p-column field="orderNo" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.orderNo">Order No</span>
                    </ng-template>
                </p-column>
                <p-column field="personId" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.personId">Customer Id</span>
                    </ng-template>
                </p-column>
                <p-column field="customerId" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.customerId">Customer Id</span>
                    </ng-template>
                </p-column>
                <p-column field="lastModifiedDate" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.lastModifiedDate">Register Date</span>
                    </ng-template>
                </p-column>
                <p-column field="price" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.price">Price</span>
                    </ng-template>
                </p-column>
                <p-column field="status" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.status">Order Status</span>
                    </ng-template>
                </p-column>
                <p-column field="buyGroup" [sortable]="true">
                    <ng-template pTemplate="header">
                        <span jhiTranslate="samtagatewayApp.order.buyGroup">buy Group</span>
                    </ng-template>
                </p-column>
                <p-column styleClass="col-button"></p-column>
            </p-row>
            <p-row>
                <p-column>
                    <ng-template pTemplate="header">
                        <input class="form-control" type="text"
                               name="orderNo" id="field_orderNo"
                               [(ngModel)]="order.orderNo"
                               search-after-typed (onSearch)="search()"/>
                    </ng-template>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <input class="form-control" type="text"
                               name="orderNo" id="field_personId"
                               [(ngModel)]="order.personName"
                               search-after-typed (onSearch)="search()"/>
                    </ng-template>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <input class="form-control" type="text"
                               name="orderNo" id="field_customerId"
                               [(ngModel)]="order.customerName"
                               search-after-typed (onSearch)="search()"/>
                    </ng-template>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <ng2-datetimepicker [disableTime]="true" class="form-control" name="lastModifiedDate"
                                            [rtlActive]="true" time="00:00:00"
                                            [(ngModel)]="order.lastModifiedDate">
                        </ng2-datetimepicker>
                    </ng-template>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <input class="form-control"
                               name="price" id="field_price"
                               [(ngModel)]="order.price"
                               [numeric]
                               search-after-typed (onSearch)="search()"/>
                    </ng-template>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <select class="form-control" name="status" [(ngModel)]="order.status" (change)="search()"
                                id="field_status">
                            <option></option>
                            <option value="DRAFT">{{'samtagatewayApp.OrderStatus.DRAFT' | translate}}</option>
                            <option value="PENDING">{{'samtagatewayApp.OrderStatus.PENDING' | translate}}</option>
                            <option value="PAID">{{'samtagatewayApp.OrderStatus.PAID' | translate}}</option>
                            <option value="CONFIRM">{{'samtagatewayApp.OrderStatus.CONFIRM' | translate}}</option>
                            <option value="SEND_TO_DEPOT">{{'samtagatewayApp.OrderStatus.SEND_TO_DEPOT' | translate}}
                            </option>
                            <option value="EXIT_FROM_DEPOT">{{'samtagatewayApp.OrderStatus.EXIT_FROM_DEPOT' |
                                translate}}
                            </option>
                            <option value="BACK_FROM_SALE">{{'samtagatewayApp.OrderStatus.BACK_FROM_SALE' |
                                translate}}
                            </option>
                            <option value="BACK_FROM_DEPOT">{{'samtagatewayApp.OrderStatus.BACK_FROM_DEPOT' |
                                translate}}
                            </option>
                        </select>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <select class="form-control" name="buyGroup" [(ngModel)]="order.buyGroup" (change)="search()"
                                id="field_buyGroup">
                            <option></option>
                            <option value="CASH">{{'samtagatewayApp.BuyGroup.CASH' | translate}}</option>
                            <option value="CREDIT">{{'samtagatewayApp.BuyGroup.CREDIT' | translate}}</option>
                            <option value="QUOTA">{{'samtagatewayApp.BuyGroup.QUOTA' | translate}}</option>
                            <option value="PREBUY">{{'samtagatewayApp.BuyGroup.PREBUY' | translate}}</option>
                            <option value="FINANCIAL_LICENSE">{{'samtagatewayApp.BuyGroup.FINANCIAL_LICENSE' |
                                translate}}
                            </option>
                        </select>
                </p-column>
                <p-column>
                    <ng-template pTemplate="header">
                        <button class="btn btn-info" (click)="search()">
                            <span class="fa fa-search"></span>
                        </button>
                        <button class=" btn btn-danger" (click)="clear()">
                            <span class="fa fa-trash-o"></span>
                        </button>
                    </ng-template>
                </p-column>
            </p-row>
        </p-headerColumnGroup>
        <p-column field="orderNo" [header]="'samtagatewayApp.order.orderNo' | translate"></p-column>
        <p-column field="personName" [header]="'samtagatewayApp.order.personId' | translate"></p-column>
        <p-column field="customerName" [header]="'samtagatewayApp.order.customerId' | translate"></p-column>
        <p-column field="lastModifiedDate" [header]="'samtagatewayApp.order.lastModifiedDate' | translate">
            <ng-template let-item="rowData" pTemplate="body">
                <span>{{item.lastModifiedDate | dateJalali}}</span>
            </ng-template>
        </p-column>
        <p-column field="price" [header]="'samtagatewayApp.order.price' | translate"></p-column>
        <p-column field="status" [header]="'samtagatewayApp.order.status' | translate">
            <ng-template let-item="rowData" pTemplate="body">
                <span
                    *ngIf="item.status!==OrderStatus[OrderStatus.PAID] && item.status!==OrderStatus[OrderStatus.CONFIRM] "
                    jhiTranslate="{{'samtagatewayApp.OrderStatus.' + item.status}}">{{item.status}}</span>
                <ng-container
                    *ngIf="item.status===OrderStatus[OrderStatus.PAID]">
                    <button class="btn btn-primary"
                            *jhiHasAnyAuthority="['ROLE_ADMIN', 'CONFIRM_ORDER']"
                            replaceUrl="true"
                            [routerLink]="['/', { outlets: { popup: 'order/confirm/'+ item.id } }]">
                        <span class="fa fa-check"></span>
                        <span jhiTranslate="entity.action.confirm"></span>
                    </button>
                </ng-container>
                <ng-container
                    *ngIf="item.status===OrderStatus[OrderStatus.CONFIRM]">
                    <button class="btn btn-danger"
                            *jhiHasAnyAuthority="['ROLE_ADMIN', 'CONFIRM_ORDER']"
                            replaceUrl="true"
                            [routerLink]="['/', { outlets: { popup: 'order/revert-confirm/'+ item.id} }]">
                        <!--<span class="fa fa-check"></span>-->
                        <span jhiTranslate="entity.action.revertConfirm"></span>
                    </button>
                </ng-container>
            </ng-template>
        </p-column>
        <p-column field="buyGroup" [header]="'samtagatewayApp.order.buyGroup' | translate">
            <ng-template let-item="rowData" pTemplate="body">
                <span *ngIf="item.buyGroup" jhiTranslate="{{'samtagatewayApp.BuyGroup.' + item.buyGroup}}">{{item.buyGroup}}</span>
            </ng-template>
        </p-column>
        <p-column class="component">
            <ng-template let-item="rowData" pTemplate="body">
                <div class="btn-group" ngbDropdown placement="right">
                    <div>
                        <button [disabled]="item.status!=='DRAFT'&&item.status!=='PAID'" type="button"
                                class="btn btn-primary"
                                *jhiHasAnyAuthorityDisabled="['ROLE_ADMIN', 'EDIT_ORDER']"
                                replaceUrl="true"
                                [routerLink]="[item.id + '/edit/'+0]">
                            <span class="fa fa-edit"></span>
                            <span jhiTranslate="entity.action.edit">ویرایش</span>
                        </button>
                    </div>

                    <button class="btn btn-primary"
                            *jhiHasAnyAuthorityDisabled="['ROLE_ADMIN', 'VIEW_ORDER', 'DELETE_ORDER','REVOCATION_ORDER','PRINT_ORDER','PRINT_AGAIN_ORDER']"
                            ngbDropdownToggle></button>
                    <div class="dropdown-menu" ngbDropdownMenu>
                        <button [hidden]="(item.printCount>0)" class="dropdown-item"
                                *jhiHasAnyAuthority="['ROLE_ADMIN', 'PRINT_ORDER']"
                                replaceUrl="true"
                                [routerLink]="['/order/' + mode + '/' + item.id + '/print']">
                            <span class="fa fa-print"></span>
                            <span jhiTranslate="entity.action.print">چاپ</span>
                        </button>
                        <button [hidden]="!(item.printCount>0)" class="dropdown-item"
                                *jhiHasAnyAuthority="['ROLE_ADMIN', 'PRINT_AGAIN_ORDER']"
                                replaceUrl="true"
                                [routerLink]="['/order/' + mode + '/' + item.id + '/print']">
                            <span class="fa fa-print"></span>
                            <span jhiTranslate="entity.action.printAgain">چاپ</span>
                        </button>
                        <!--<button class="dropdown-item"
                                *jhiHasAnyAuthority="['ROLE_ADMIN', 'VIEW_ORDER']"
                                replaceUrl="true"
                                [routerLink]="['/', { outlets: { popup: 'order/'+ item.id + '/view'} }]">
                            <span class="fa fa-eye"></span>
                            <span jhiTranslate="entity.action.view">نمایش</span>
                        </button>-->
                        <button [hidden]="(item.status!=='DRAFT' && item.status!=='PAID')" class="dropdown-item"
                                *jhiHasAnyAuthority="['ROLE_ADMIN', 'DELETE_ORDER']"
                                replaceUrl="true"
                                [routerLink]="['/', { outlets: { popup: 'order/'+ item.id + '/delete'} }]">
                            <span class="fa fa-remove"></span>
                            <span jhiTranslate="entity.action.delete">delete</span>
                        </button>
                        <button [hidden]="mode!='order' ||(item.status!='PAID' && item.status!='BACK_FROM_SALE')"
                                class="dropdown-item"
                                *jhiHasAnyAuthority="['ROLE_ADMIN', 'REVOCATION_ORDER']"
                                replaceUrl="true"
                                [routerLink]="['/', { outlets: { popup: 'order/'+ item.id + '/revocation'} }]">
                            <span class="fa fa-remove"></span>
                            <span jhiTranslate="entity.action.revocation">revocation</span>
                        </button>

                    </div>
                </div>
            </ng-template>
        </p-column>
    </p-dataTable>

</div>
